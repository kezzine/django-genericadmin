{% load adminmedia genericadmin %}
{% get_generic_relation_list %}
if (typeof(JQUERY_LIB) == 'undefined')
  var JQUERY_LIB = "http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js";
var ADMIN_MEDIA_URL = "{% admin_media_prefix %}";
var ADMIN_OBJ_LOOKUP_URL = "{% url admin_genericadmin_obj_lookup %}";
function loadFile(a,b){if(b=="js"){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",a)}else{if(b=="css"){var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a)}}if(typeof c!="undefined"){document.getElementsByTagName("head")[0].appendChild(c)}}function GenericObject(c,b){this.objectIdEl=b;this.contentTypeEl;this.contentTypeId;this.objectId;this.lookupLink=$('<a class="related-lookup"></a>');this.lookupLink.click(function(){if(a.contentTypeEl.value){a.showRelatedObjectLookupPopup(this)}return false});this.lookupLink.attr("id","lookup_"+this.objectIdEl.id);this.lookupIcon=$('<img src="'+ADMIN_MEDIA_URL+'img/admin/selector-search.gif" style="cursor: pointer; margin-left: 5px" width="16" height="16" alt="Lookup">');this.lookupLink.append(this.lookupIcon);this.lookupText=$('<strong style="width: 100px; margin-left: 5px"></strong>');var a=this;this.__init__=function(){vars=this.objectIdEl.id.split("-");if(vars.length==1){id="#id_content_type"}else{id="#"+vars[0]+"-"+vars[1]+"-content_type"}this.contentTypeEl=$(id)[0];if(this.contentTypeEl.value){this.contentTypeId=this.contentTypeEl.value;this.lookupLink.attr("href","../../../"+MODEL_URL_ARRAY[this.contentTypeEl.value]+"/");if(this.objectIdEl.value){this.objectId=this.objectIdEl.value;this.updateObjectIdEl()}}$(this.contentTypeEl).change(function(){a.contentTypeId=this.value;a.lookupLink.attr("href","../../../"+MODEL_URL_ARRAY[this.value]+"/")});$(this.objectIdEl).after(this.lookupLink).after(this.lookupText).css("width","10px");$(this.objectIdEl).change(function(){a.objectId=this.value;a.updateObjectIdEl()}).focus(function(){a.objectId=this.value;a.updateObjectIdEl()})};this.updateObjectIdEl=function(){if(this.objectIdEl.value&&this.contentTypeId){a.lookupText.text("loading...");$.getJSON(ADMIN_OBJ_LOOKUP_URL,{object_id:this.objectIdEl.value,content_type:this.contentTypeId},function(d){item=d[0];a.lookupText.text("");if(item.objectText){a.lookupText.text(item.objectText)}})}};this.showRelatedObjectLookupPopup=function(f){var e=f.id.replace(/^lookup_/,"");e=e.replace(/\./g,"___");var d;if(f.href.search(/\?/)>=0){d=f.href+"&pop=1"}else{d=f.href+"?pop=1"}win=window.open(d,e,"height=500,width=800,resizable=yes,scrollbars=yes");$(win).bind("beforeunload",function(){function g(h){var h=h;this.update=function(){h.updateObjectIdEl()};this.go=function(){setTimeout(this.update,200)}}updater=new g(a);updater.go()});win.focus();return false};this.__init__();return{objectIdEl:this.objectIdEl,contentTypeEl:this.contentTypeEl,lookupIcon:this.lookupIcon,lookupText:this.lookupText,lookupLink:this.lookupLink,updateObjectIdEl:this.updateObjectIdEl,showRelatedObjectLookupPopup:this.showRelatedObjectLookupPopup}}if(typeof(jQuery)=="undefined"){loadFile(JQUERY_LIB,"js")}$(document).ready(function(){$("[id$='object_id']").each(GenericObject)});